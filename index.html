<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© ÙˆØªØ­Ø¯ÙŠØ¯ Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;700&display=swap" rel="stylesheet">
    <!-- Leaflet for Maps (Lightweight & No API Key Required for Basic Views) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body {
            font-family: 'Tajawal', sans-serif;
            background-color: #f8fafc;
        }
        .card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05);
            padding: 1.5rem;
            border: 1px solid #e2e8f0;
        }
        #map {
            height: 300px;
            width: 100%;
            border-radius: 12px;
            margin-top: 1rem;
            z-index: 10;
        }
        .search-item:hover {
            background-color: #f1f5f9;
        }
        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="p-4 md:p-6 lg:p-8">

    <div class="max-w-5xl mx-auto">
        <header class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
            <div class="text-right">
                <h1 class="text-3xl font-extrabold text-slate-800 tracking-tight">Ø¥Ø¯Ø§Ø±Ø© Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©</h1>
                <p class="text-slate-500 mt-1">ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ØŒ ØªØ´ÙÙŠØ± Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§ØªØŒ ÙˆØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ†</p>
            </div>
            <div id="statusIndicator" class="flex items-center gap-2 bg-white px-4 py-2 rounded-full shadow-sm border border-slate-100 text-sm font-medium text-slate-600">
                <span class="w-2 h-2 rounded-full bg-yellow-400" id="dbStatusDot"></span>
                <span id="dbStatusText">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</span>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            
            <!-- Left Column: Search & Display -->
            <div class="lg:col-span-7 space-y-6">
                <!-- Advanced Search Card -->
                <div class="card border-r-4 border-blue-600">
                    <h2 class="text-lg font-bold mb-4 flex items-center gap-2 text-slate-800">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>
                        Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…ØªÙ‚Ø¯Ù… (Zone / FAT)
                    </h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div class="relative">
                            <label class="block text-xs font-semibold text-slate-500 mb-1 uppercase tracking-wider">Ø§Ù„Ù…Ù†Ø·Ù‚Ø© (Zone)</label>
                            <input type="text" id="zoneSearch" placeholder="Ù…Ø«Ù„Ø§Ù‹: 45" class="w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all outline-none">
                        </div>
                        <div class="relative">
                            <label class="block text-xs font-semibold text-slate-500 mb-1 uppercase tracking-wider">Ø§Ù„Ø¹Ù…ÙˆØ¯ (FAT)</label>
                            <input type="text" id="fatSearch" placeholder="Ù…Ø«Ù„Ø§Ù‹: 01" class="w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all outline-none">
                        </div>
                    </div>

                    <div id="searchResults" class="hidden max-h-60 overflow-y-auto border border-slate-200 rounded-xl bg-white shadow-sm mb-4 divide-y divide-slate-100">
                        <!-- Results injected here -->
                    </div>

                    <div id="coordsDisplay" class="hidden animate-in fade-in slide-in-from-top duration-300">
                        <div class="grid grid-cols-2 gap-3 mb-3">
                            <div class="p-3 bg-blue-50 rounded-xl border border-blue-100">
                                <span class="text-[10px] text-blue-600 font-bold block mb-1">Ø®Ø· Ø§Ù„Ø¹Ø±Ø¶</span>
                                <span id="latVal" class="font-mono text-sm font-bold text-slate-700">-</span>
                            </div>
                            <div class="p-3 bg-blue-50 rounded-xl border border-blue-100">
                                <span class="text-[10px] text-blue-600 font-bold block mb-1">Ø®Ø· Ø§Ù„Ø·ÙˆÙ„</span>
                                <span id="longVal" class="font-mono text-sm font-bold text-slate-700">-</span>
                            </div>
                        </div>
                        <div id="map"></div>
                    </div>
                </div>

                <!-- Export/Copy Area -->
                <div class="card bg-slate-900 text-white overflow-hidden relative">
                    <div class="absolute top-0 right-0 p-4 opacity-10">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-20 w-20" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3" /></svg>
                    </div>
                    <h2 class="text-lg font-bold mb-4 relative z-10">Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¬Ù‡Ø²Ø© Ù„Ù„Ø¥Ø±Ø³Ø§Ù„</h2>
                    
                    <div class="space-y-4 relative z-10">
                        <div>
                            <label class="block text-[10px] font-bold text-slate-400 mb-2 uppercase">Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ù…Ø´ÙØ±Ø© (ØªÙ‚Ø±ÙŠØ¨ 10 Ù…ØªØ±)</label>
                            <div class="flex gap-2">
                                <input type="text" id="jitteredCoordsField" readonly class="flex-1 p-3 bg-slate-800 border border-slate-700 rounded-lg font-mono text-xs text-blue-300" placeholder="0.000000, 0.000000">
                                <button type="button" onclick="copyValue('jitteredCoordsField')" class="bg-blue-600 hover:bg-blue-500 p-3 rounded-lg transition-colors">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>
                                </button>
                            </div>
                        </div>

                        <div>
                            <label class="block text-[10px] font-bold text-slate-400 mb-2 uppercase">Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø¬Ù…Ø¹ Ø§Ù„ÙƒØ§Ù…Ù„</label>
                            <textarea id="combinedField" readonly class="w-full p-3 bg-slate-800 border border-slate-700 rounded-lg font-medium text-sm h-28 resize-none focus:outline-none focus:border-blue-500" placeholder="Ø³ÙŠØªÙ… ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù‡Ù†Ø§..."></textarea>
                        </div>

                        <button onclick="copyValue('combinedField')" class="w-full bg-white text-slate-900 font-bold py-3 rounded-xl hover:bg-slate-100 transition-all flex justify-center items-center gap-2">
                            <span>Ù†Ø³Ø® ÙƒØ§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" /></svg>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Right Column: Form -->
            <div class="lg:col-span-5">
                <div class="card sticky top-6">
                    <h2 class="text-lg font-bold mb-6 text-slate-800 flex items-center gap-2 border-b pb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>
                        Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´ØªØ±Ùƒ ÙˆØ§Ù„Ù…Ø³ÙˆÙ‚
                    </h2>
                    
                    <form id="dataForm" class="space-y-5">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1.5">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ÙˆÙ‚</label>
                                <input type="text" id="marketerName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„" required class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-green-500 transition-all outline-none">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1.5">Ø§Ø³Ù… Ø§Ù„Ø­ÙŠ / Ø§Ù„Ù…Ø­Ù„Ø©</label>
                                <input type="text" id="neighborhood" placeholder="Ø³ÙŠØ¸Ù‡Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹" class="w-full p-3 bg-slate-100 border border-slate-200 rounded-xl outline-none cursor-not-allowed text-slate-500" readonly>
                            </div>

                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-1.5">Ø§Ù„Ø²Ù‚Ø§Ù‚</label>
                                    <input type="text" id="alley" placeholder="--" class="w-full p-3 bg-slate-100 border border-slate-200 rounded-xl outline-none text-center text-slate-500" readonly>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-1.5">Ø±Ù‚Ù… Ø§Ù„Ø¯Ø§Ø±</label>
                                    <input type="text" id="houseNum" placeholder="--" class="w-full p-3 bg-slate-100 border border-slate-200 rounded-xl outline-none text-center text-slate-500" readonly>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1.5">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</label>
                                <textarea id="notes" placeholder="Ø£Ø¯Ø®Ù„ Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¹Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø£Ùˆ Ø§Ù„Ù…Ø´ØªØ±Ùƒ" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-green-500 transition-all outline-none h-20 resize-none"></textarea>
                            </div>
                        </div>

                        <div class="pt-4">
                            <button type="submit" id="submitBtn" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg shadow-green-100 flex justify-center items-center gap-2 text-lg">
                                <span>Ø­ÙØ¸ ÙˆØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</span>
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="toast" class="fixed bottom-6 right-6 transform translate-y-24 opacity-0 transition-all duration-300 ease-out z-50">
        <div class="bg-slate-900 text-white px-6 py-3 rounded-2xl shadow-2xl flex items-center gap-3">
            <div id="toastIcon"></div>
            <span id="toastMsg" class="font-medium"></span>
        </div>
    </div>

    <script>
        /**
         * Core Configuration & State
         */
        let poleData = [];
        let selectedPole = null;
        let map = null;
        let marker = null;

        /**
         * Utility Functions
         */
        function jitterCoordinate(val) {
            // Approx 10-15 meters jitter
            const jitterAmount = 0.00015; 
            const jitter = Math.random() * jitterAmount;
            const direction = Math.random() < 0.5 ? -1 : 1;
            return (val + (jitter * direction)).toFixed(6);
        }

        function showToast(msg, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMsg = document.getElementById('toastMsg');
            const toastIcon = document.getElementById('toastIcon');
            
            toastMsg.innerText = msg;
            toastIcon.innerHTML = type === 'success' 
                ? '<svg class="w-5 h-5 text-green-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>'
                : '<svg class="w-5 h-5 text-red-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg>';
            
            toast.classList.remove('translate-y-24', 'opacity-0');
            setTimeout(() => toast.classList.add('translate-y-24', 'opacity-0'), 3000);
        }

        function copyValue(id) {
            const el = document.getElementById(id);
            const val = el.value || el.innerText;
            if (!val || val === '-' || val.includes('..')) return;

            // Handle Clipboard API or Fallback
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(val).then(() => showToast('ØªÙ… Ø§Ù„Ù†Ø³Ø® Ù„Ù„Ù…Ø­Ø§ÙØ¸Ø©'));
            } else {
                const textArea = document.createElement("textarea");
                textArea.value = val;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    showToast('ØªÙ… Ø§Ù„Ù†Ø³Ø® Ù„Ù„Ù…Ø­Ø§ÙØ¸Ø©');
                } catch (err) {
                    console.error('Copy failed', err);
                }
                document.body.removeChild(textArea);
            }
        }

        /**
         * Map Integration
         */
        function initMap(lat, lng) {
            if (!map) {
                map = L.map('map').setView([lat, lng], 17);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    maxZoom: 19,
                    attribution: 'Â© OpenStreetMap'
                }).addTo(map);
                marker = L.marker([lat, lng]).addTo(map);
            } else {
                map.setView([lat, lng], 17);
                marker.setLatLng([lat, lng]);
            }
        }

        /**
         * Data Logic
         */
        function parseCSV(csvText) {
            const lines = csvText.split(/\r?\n/).filter(line => line.trim() !== "");
            if (lines.length < 2) return [];
            
            const headers = lines[0].split(',').map(h => h.trim());
            return lines.slice(1).map(line => {
                const values = line.split(',');
                const obj = {};
                headers.forEach((h, i) => {
                    let val = values[i] ? values[i].trim() : "";
                    if (h === 'lat' || h === 'long') val = parseFloat(val);
                    obj[h] = val;
                });
                return obj;
            });
        }

        async function loadData() {
            const statusDot = document.getElementById('dbStatusDot');
            const statusText = document.getElementById('dbStatusText');
            
            try {
                // Simulated fetch since we don't have the actual file in this environment
                // In production, use: const response = await fetch('sm_data.csv');
                const mockCSV = `OLT_ID,FAT_ID,NumZone,NumFat,AddrZone,lat,long\nFTK0045,FAT01,45,01,Ø§Ù„Ù…Ù†ØµÙˆØ± - Ø­ÙŠ Ø¯Ø±Ø§Øº,33.3281,44.3415\nFTK0045,FAT02,45,02,Ø§Ù„Ù…Ù†ØµÙˆØ± - Ø­ÙŠ Ø¯Ø±Ø§Øº,33.3285,44.3420\nFTK0046,FAT01,46,01,Ø§Ù„ÙŠØ±Ù…ÙˆÙƒ - Ø§Ù„Ø§Ø±Ø¨Ø¹ Ø´ÙˆØ§Ø±Ø¹,33.3100,44.3500`;
                
                // For live use, uncomment below:
                // const response = await fetch('sm_data.csv');
                // const csvText = await response.text();
                // poleData = parseCSV(csvText);
                
                poleData = parseCSV(mockCSV); 
                
                statusDot.classList.replace('bg-yellow-400', 'bg-green-500');
                statusText.innerText = `ØªÙ… ØªØ­Ù…ÙŠÙ„ ${poleData.length} Ø¹Ù…ÙˆØ¯`;
            } catch (error) {
                statusDot.classList.replace('bg-yellow-400', 'bg-red-500');
                statusText.innerText = "Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª";
                console.error(error);
            }
        }

        function updateCombinedText() {
            const name = document.getElementById('marketerName').value || "Ø§Ø³Ù… Ø§Ù„Ù…Ø³ÙˆÙ‚";
            const notes = document.getElementById('notes').value || "";
            
            if (selectedPole) {
                const zone = selectedPole.OLT_ID || selectedPole.NumZone || "Ø§Ù„Ø²ÙˆÙ†";
                const fat = selectedPole.FAT_ID || selectedPole.NumFat || "FAT";
                const addr = selectedPole.AddrZone || "Ø§Ù„Ø­ÙŠ";
                const jLat = jitterCoordinate(selectedPole.lat);
                const jLong = jitterCoordinate(selectedPole.long);
                
                const jittered = `${jLat}, ${jLong}`;
                document.getElementById('jitteredCoordsField').value = jittered;

                const text = `ğŸ”¹ *Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬Ø¯ÙŠØ¯* ğŸ”¹\n\nğŸ‘¤ Ø§Ù„Ù…Ø³ÙˆÙ‚: ${name}\nğŸ“ Ø§Ù„Ø­ÙŠ: ${addr}\nğŸ”¢ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©: ${zone}\nğŸš§ Ø§Ù„Ø¹Ù…ÙˆØ¯: ${fat}\nğŸŒ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ù…Ø´ÙØ±Ø©: ${jittered}\nğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª: ${notes || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}`;
                document.getElementById('combinedField').value = text;
            }
        }

        function selectFat(idx) {
            selectedPole = poleData[idx];
            
            // Fill form
            document.getElementById('neighborhood').value = selectedPole.AddrZone || "";
            document.getElementById('alley').value = selectedPole.NumFat || "";
            document.getElementById('houseNum').value = selectedPole.NumFat || "";
            
            // Fill Display
            document.getElementById('latVal').innerText = selectedPole.lat;
            document.getElementById('longVal').innerText = selectedPole.long;
            
            // UI States
            document.getElementById('coordsDisplay').classList.remove('hidden');
            document.getElementById('searchResults').classList.add('hidden');
            
            // Map
            initMap(selectedPole.lat, selectedPole.long);
            
            // Refresh Compiled Text
            updateCombinedText();
            showToast('ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ù†Ø¬Ø§Ø­');
        }

        function setupSearch() {
            const zoneInp = document.getElementById('zoneSearch');
            const fatInp = document.getElementById('fatSearch');
            const resultsDiv = document.getElementById('searchResults');

            const handler = () => {
                const z = zoneInp.value.toLowerCase();
                const f = fatInp.value.toLowerCase();

                if (!z && !f) {
                    resultsDiv.classList.add('hidden');
                    return;
                }

                const filtered = poleData.filter((p, i) => {
                    const matchZ = (p.OLT_ID || "").toLowerCase().includes(z) || (p.NumZone || "").toString().includes(z);
                    const matchF = (p.FAT_ID || "").toLowerCase().includes(f) || (p.NumFat || "").toString().includes(f);
                    p._idx = i;
                    return matchZ && matchF;
                }).slice(0, 15);

                if (filtered.length > 0) {
                    resultsDiv.classList.remove('hidden');
                    resultsDiv.innerHTML = filtered.map(p => `
                        <div class="p-3 search-item cursor-pointer transition-colors" onclick="selectFat(${p._idx})">
                            <div class="flex justify-between items-start">
                                <div>
                                    <div class="font-bold text-slate-800">${p.FAT_ID}</div>
                                    <div class="text-[10px] text-slate-500 font-medium">${p.OLT_ID}</div>
                                </div>
                                <span class="text-[10px] bg-blue-50 text-blue-700 px-2 py-1 rounded-md font-bold">Zone ${p.NumZone}</span>
                            </div>
                            <div class="text-[11px] text-slate-400 mt-1 italic">${p.AddrZone || 'Ø¹Ù†ÙˆØ§Ù† ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</div>
                        </div>
                    `).join('');
                } else {
                    resultsDiv.innerHTML = '<div class="p-4 text-center text-slate-400 text-sm">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø©</div>';
                }
            };

            zoneInp.addEventListener('input', handler);
            fatInp.addEventListener('input', handler);
            document.getElementById('marketerName').addEventListener('input', updateCombinedText);
            document.getElementById('notes').addEventListener('input', updateCombinedText);
        }

        /**
         * Initialize
         */
        window.onload = () => {
            loadData();
            setupSearch();

            document.getElementById('dataForm').onsubmit = (e) => {
                e.preventDefault();
                if (!selectedPole) {
                    showToast('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø¹Ù…ÙˆØ¯ Ø£ÙˆÙ„Ø§Ù‹ Ù…Ù† Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«', 'error');
                    return;
                }
                
                // Logic for saving to a database would go here
                showToast('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ù†Ø³Ø® Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø¬Ù…Ø¹');
                updateCombinedText();
            };
        };
    </script>
</body>
</html>
